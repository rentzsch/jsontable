<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>JSONTable demo-server</title>
    <style>
      input[type="number"] {
        width: 5em;
      }
    </style>
  </head>
  <body>
    <form name="streamForm">
      Stream <input name="count" type="number" value="10" min="1" /> rows, 1
      every
      <input name="interval" type="number" value="1000" min="0" /> milliseconds
    </form>
    <!-- Flouting the "rules"
      https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events#inline_event_handlers_%E2%80%94_dont_use_these
    -->
    <button onclick="return handleReadStreamClick()">Stream</button>
    <hr />
    <table id="output">
      <thead>
        <tr>
          Timestamp
        </tr>
        <tr>
          UUID
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      async function handleReadStreamClick() {
        const url = new URL(window.location.href);
        url.pathname = "read-stream";
        url.search = new URLSearchParams({
          count: document.streamForm.count.value,
          interval: document.streamForm.interval.value,
        });
        const response = await fetch(url);
        const reader = response.body.getReader();
        while (true) {
          const { value, done } = await reader.read();
          if (done) break;
          console.log("Received", value);
        }

        console.log("Response fully received");
        return false;
      }
    </script>
  </body>
</html>
